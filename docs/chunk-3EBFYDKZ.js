import{a as re,b as ne}from"./chunk-KAFTCFFA.js";import"./chunk-H2ZXO6MP.js";import{a as T}from"./chunk-TM75FGBG.js";import"./chunk-ULV6KZCQ.js";import{a as Y}from"./chunk-K6AQFHQZ.js";import{a as z}from"./chunk-XGG2NXRS.js";import{b as f,e as H,f as h}from"./chunk-UNETXBBP.js";import{a as te}from"./chunk-ONVS2USS.js";import{a as C,b as Z,g as ee}from"./chunk-VAS7ZGTW.js";import{a as v,b as X,c as S,g as ie}from"./chunk-BS6GGXZ2.js";import"./chunk-AT2Y7737.js";import{A as _,B as G,C as s,D as l,E as c,F as V,I as y,K as d,L as a,Q as I,S as b,W as D,Y as k,aa as M,b as A,ba as O,ca as q,da as R,g as F,i as g,j as E,ja as U,ka as j,p as m,pa as Q,q as u,ra as L,ua as $,x as p,xa as W,y as B,ya as J,za as K}from"./chunk-R7YALVTQ.js";import{a as w,k as N}from"./chunk-6ZVQRB5I.js";import"./chunk-LGOCNUIX.js";var x=class{constructor(){let t={title:"",description:"",state:C.New,category:v.TextBooksEducationalMaterial,images:[]};this.form=new H({title:new h(t.title,[f.required]),description:new h(t.description,[f.required]),state:new h(C.New,[f.required]),category:new h(v.TextBooksEducationalMaterial,[f.required]),gender:new h(null),images:new h(t.images,[f.required])})}get gender(){return this.withGender?this.article.gender:""}get withGender(){return new X().isWithGender(this.article.category)}get article(){return this.form.value}get isFormValid(){return this.form.valid}getValue(t){return this.form.get(t)?.value}articleToSaveOrUpdate(){let t=this.article;return this.withGender||(t.title=this.getValue("title"),t.description=this.getValue("description"),t.state=this.getValue("state"),t.category=this.getValue("category"),t.images=this.getValue("images")),t}addImage(t){this.article.images.push(t),this.updateImages()}setValuesFromArticle(t){this.setValue("title",t.title),this.setValue("description",t.description),this.setValue("state",t.state),this.setValue("category",t.category),this.setValue("gender",t.gender),this.form.get("images")?.setValue(t.images)}deleteImages(){this.article.images=[],this.updateImages()}setValue(t,r){this.form.get(t)?.setValue(r)}updateImages(){this.form.get("images")?.setValue(this.article.images)}};var oe=(()=>{let t=class t extends ie{constructor(){super({}),this.articleService=g(te),this.authService=g($),this.router=g(L),this.articleMapper=g(ee),this.isUpdate=!1,this.onlyFirstTime=!0,this.articleForm=new x,this.setSucceed(this.articleForm.article)}get gender(){return this.articleForm.gender}get withGender(){return this.articleForm.withGender}get article(){return this.articleForm.article}get isCompleted(){return super.isCompleted()&&this.isUpdate&&this.onlyFirstTime&&(this.articleForm.setValuesFromArticle(this.result()),this.onlyFirstTime=!1),super.isCompleted}get isFormValid(){return this.articleForm.isFormValid}get images(){return this.article.images}get containsImages(){return this.images.length>0}deleteImages(){this.articleForm.deleteImages()}setValue(e,i){this.articleForm.setValue(e,i)}setArticleById(e){let i=this.articleService.getById(e).pipe(A(o=>this.articleMapper.mapTypesToCamelCase(o)));this.execute(i),this.isUpdate=!0,this.onlyFirstTime=!0}publishArticle(){let e=this.articleMapper.mapTypesToUpperSnakeCase(this.articleForm.articleToSaveOrUpdate());this.articleForm.isFormValid&&(this.isUpdate?this.update(e):this.save(e)),this.articleForm=new x,this.setSucceed({})}addImage(e){this.articleForm.addImage(e)}save(e){this.articleService.save(this.authService.user.id,e).subscribe(()=>this.router.navigate([`${w.Profile}`]).then())}update(e){this.articleService.update(this.result().id,e).subscribe(()=>this.router.navigate([`${w.Profile}`]).then())}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=F({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();function ae(n,t){if(n&1){let r=y();l(0,"app-select",2),d("selectedOption",function(i){m(r);let o=a(2);return u(o.onSelectedGender(i))}),c()}if(n&2){let r=a(2);s("options",r.genders)("optionSelected",r.service.gender)("title","G\xE9nero")}}function le(n,t){if(n&1){let r=y();l(0,"app-button",12),d("click",function(){m(r);let i=a(2);return u(i.service.deleteImages())}),c()}if(n&2){let r=a(2);s("description","Eliminar fotos")("icon",r.Icon.Delete)("typeButton",r.TypeButton.Secondary)}}function ce(n,t){n&1&&(l(0,"span",13),b(1,"Por favor, antes de publicar el art\xEDculo, completa los campos obligatorios..."),c())}function pe(n,t){if(n&1&&V(0,"app-button",14),n&2){let r=a(2);s("description","Publicar art\xEDculo")("icon",r.Icon.Save)("typeButton",r.TypeButton.Primary)}}function me(n,t){if(n&1){let r=y();l(0,"div")(1,"app-input",1),d("textChanged",function(i){m(r);let o=a();return u(o.onTitleChanged(i))}),c(),l(2,"app-select",2),d("selectedOption",function(i){m(r);let o=a();return u(o.onSelectedCategory(i))}),c(),l(3,"div",3),_(4,ae,1,3,"ng-template",4),l(5,"app-select",2),d("selectedOption",function(i){m(r);let o=a();return u(o.onSelectedState(i))}),c()(),l(6,"app-input",5),d("textChanged",function(i){m(r);let o=a();return u(o.onDescriptionChanged(i))}),c(),l(7,"span",6),b(8,"Galer\xEDa"),c(),V(9,"app-gallery",7),l(10,"div")(11,"app-button-select-image",8),d("imageSelected",function(i){m(r);let o=a();return u(o.onImageSelected(i))}),c(),_(12,le,1,3,"ng-template",4),c(),l(13,"div",9),d("click",function(){m(r);let i=a();return u(i.publishArticle())}),_(14,ce,2,0,"ng-template",10),_(15,pe,1,3,"ng-template",null,11,R),c()()}if(n&2){let r=G(16),e=a();D("c-publish-article-page ",e.getLayout(),""),p(1),s("icon",e.Icon.Edit)("placeholder","Ingresa el nombre del art\xEDculo")("value",e.service.article.title)("title","T\xEDtulo"),p(1),s("options",e.categories)("optionSelected",e.service.article.category)("title","Categor\xEDas"),p(1),I("double-column",e.service.withGender),p(1),s("ngIf",e.service.withGender),p(1),s("options",e.states)("optionSelected",e.service.article.state)("title","Estado"),p(1),s("isTextArea",!0)("placeholder","Ingresa la descripci\xF3n del art\xEDculo")("title","Descripci\xF3n")("value",e.service.article.description),p(3),s("images",e.service.article.images),p(1),I("c-publish-article-page__gallery-buttons",e.service.containsImages),p(2),s("ngIf",e.service.containsImages),p(2),s("ngIfElse",r)("ngIf",!e.service.isFormValid)}}var Ze=(()=>{let t=class t{constructor(e){this.activatedRoute=e,this.TypeButton=J,this.Icon=W,this.getLayout=N,this.categories=S(v),this.states=S(C),this.genders=S(Z),this.articleId=this.activatedRoute.snapshot.params.id,this.service=g(oe),this.imageService=g(ne),this.articleId&&this.service.setArticleById(this.articleId)}onTitleChanged(e){this.service.setValue("title",e)}onSelectedState(e){this.service.setValue("state",e)}onSelectedCategory(e){this.service.setValue("category",e)}onSelectedGender(e){this.service.setValue("gender",e)}onDescriptionChanged(e){this.service.setValue("description",e)}onImageSelected(e){this.imageService.uploadImage(e).subscribe(i=>{this.service.addImage(i.data.url),this.gallery.updateSlider()})}publishArticle(){this.service.publishArticle()}};t.\u0275fac=function(i){return new(i||t)(B(Q))},t.\u0275cmp=E({type:t,selectors:[["ng-component"]],viewQuery:function(i,o){if(i&1&&O(T,5),i&2){let P;M(P=q())&&(o.gallery=P.first)}},standalone:!0,features:[k],decls:1,vars:1,consts:[[3,"class",4,"ngIf"],[3,"icon","placeholder","value","title","textChanged"],[3,"options","optionSelected","title","selectedOption"],[1,"c-publish-article-page__gender-state"],[3,"ngIf"],[3,"isTextArea","placeholder","title","value","textChanged"],[1,"o-text-xl-semibold"],[3,"images"],[3,"imageSelected"],[1,"c-publish-article-page__container-proposed",3,"click"],[3,"ngIfElse","ngIf"],["publishArticleTemplate",""],[3,"description","icon","typeButton","click"],[1,"o-text-sm-bold"],[3,"description","icon","typeButton"]],template:function(i,o){i&1&&_(0,me,17,26,"div",0),i&2&&s("ngIf",o.service.isCompleted())},dependencies:[j,U,z,Y,T,K,re],encapsulation:2});let n=t;return n})();export{Ze as PublishArticlePageComponent};
